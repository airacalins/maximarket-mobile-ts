{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useState } from 'react';\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport View from \"react-native-web/dist/exports/View\";\nimport LoadingScreen from \"../../components/indicator/LoadingScreen\";\nimport FormTextInput from \"../../components/input/FormTextInput\";\nimport AppText from \"../../components/text/AppText\";\nimport { useAppDispatch, useAppSelecter } from \"../../store/configureStore\";\nimport colors from \"../../styles/colors\";\nimport { styles } from \"../../styles/styles\";\nimport { MaterialIcons } from '@expo/vector-icons';\nimport RNPickerSelect from 'react-native-picker-select';\nimport * as ImagePicker from 'expo-image-picker';\nimport { FontAwesome } from '@expo/vector-icons';\nimport AppButton from \"../../components/button/AppButton\";\nimport { fetchInvoiceDetailsAsync, fetchInvoicesAsync, createPaymentAsync, resetPaymentResult } from \"../../reducers/invoiceSlice\";\nimport { Formik } from 'formik';\nimport { fetchModeOfPaymentsAsync } from \"../../reducers/modeOfPaymentSlice\";\nimport routes from \"../../navigations/routes\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nvar PaymentFormScreen = function PaymentFormScreen(_ref) {\n  var navigation = _ref.navigation;\n  var dispatch = useAppDispatch();\n\n  var _useAppSelecter = useAppSelecter(function (state) {\n    return state.tenant;\n  }),\n      tenant = _useAppSelecter.tenant;\n\n  var _useAppSelecter2 = useAppSelecter(function (state) {\n    return state.invoice;\n  }),\n      invoice = _useAppSelecter2.invoice,\n      isFetchingInvoiceDetails = _useAppSelecter2.isFetchingInvoiceDetails,\n      isSaving = _useAppSelecter2.isSaving;\n\n  var _useAppSelecter3 = useAppSelecter(function (state) {\n    return state.modeOfPayment;\n  }),\n      modeOfPayments = _useAppSelecter3.modeOfPayments,\n      isFetchingModeOfPayments = _useAppSelecter3.isFetchingModeOfPayments;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      modeOfPaymentId = _useState2[0],\n      setModeOfPaymentId = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      amount = _useState4[0],\n      setAmount = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      image = _useState6[0],\n      setImage = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      imageData = _useState8[0],\n      setImageData = _useState8[1];\n\n  var _useState9 = useState({\n    modeOfPaymentId: \"\",\n    amount: 0,\n    file: \"\"\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      payment = _useState10[0],\n      setPayment = _useState10[1];\n\n  var bg_light = styles.bg_light,\n      container = styles.container,\n      my_5 = styles.my_5,\n      p_5 = styles.p_5,\n      row_center = styles.row_center,\n      p_30 = styles.p_30;\n  var darkGrey = colors.darkGrey,\n      primary = colors.primary;\n  useEffect(function () {\n    if (modeOfPayments.length > 0) {\n      setModeOfPaymentId(modeOfPayments[0].id);\n    }\n  }, [modeOfPayments]);\n  useEffect(function () {\n    dispatch(resetPaymentResult());\n    dispatch(fetchModeOfPaymentsAsync());\n  }, []);\n  useEffect(function () {\n    if (!invoice) fetchInvoiceDetailsAsync(tenant == null ? void 0 : tenant.tenantUniqueId);\n  }, [invoice]);\n\n  var pickImage = function pickImage() {\n    var result;\n    return _regeneratorRuntime.async(function pickImage$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              base64: true,\n              mediaTypes: ImagePicker.MediaTypeOptions.All,\n              allowsEditing: true,\n              quality: 1\n            }));\n\n          case 2:\n            result = _context.sent;\n\n            if (!result.cancelled) {\n              setImage(result.uri);\n              setImageData(result.base64);\n            }\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var _onSubmit = function onSubmit() {\n    return _regeneratorRuntime.async(function onSubmit$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!!setModeOfPaymentId && !!amount && !!image)) {\n              _context2.next = 8;\n              break;\n            }\n\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(dispatch(createPaymentAsync({\n              invoiceId: invoice == null ? void 0 : invoice.id,\n              modeOfPaymentId: modeOfPaymentId,\n              amount: amount,\n              file: imageData\n            })));\n\n          case 3:\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(dispatch(fetchInvoicesAsync(tenant == null ? void 0 : tenant.tenantUniqueId)));\n\n          case 5:\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(dispatch(fetchInvoiceDetailsAsync(invoice == null ? void 0 : invoice.id)));\n\n          case 7:\n            navigation.navigate(routes.PAYMENT_RECEIPT);\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  if (isFetchingInvoiceDetails || !invoice || isFetchingModeOfPayments || isSaving) return _jsx(LoadingScreen, {});\n  var invoiceNumber = invoice.invoiceNumber;\n  return _jsxs(View, {\n    style: container,\n    children: [_jsxs(View, {\n      style: [my_5],\n      children: [_jsx(AppText, {\n        as: \"h5\",\n        bold: true,\n        color: darkGrey,\n        children: \"Invoice Number\"\n      }), _jsx(AppText, {\n        bold: true,\n        children: invoiceNumber\n      })]\n    }), _jsx(Formik, {\n      initialValues: payment,\n      onSubmit: function onSubmit() {\n        _onSubmit();\n      },\n      children: function children(_ref2) {\n        var handleSubmit = _ref2.handleSubmit,\n            setFieldTouched = _ref2.setFieldTouched,\n            errors = _ref2.errors,\n            touched = _ref2.touched;\n        return _jsxs(_Fragment, {\n          children: [_jsxs(View, {\n            style: my_5,\n            children: [_jsx(AppText, {\n              as: \"h5\",\n              bold: true,\n              color: darkGrey,\n              children: \"Mode of Payment\"\n            }), _jsx(View, {\n              style: [bg_light, my_5, p_5],\n              children: _jsx(RNPickerSelect, {\n                onValueChange: function onValueChange(value) {\n                  return setModeOfPaymentId(value);\n                },\n                items: modeOfPayments.map(function (i) {\n                  return {\n                    label: i.bankName,\n                    value: i.id || undefined\n                  };\n                }),\n                placeholder: {},\n                style: {\n                  inputAndroid: {\n                    color: 'black'\n                  }\n                },\n                useNativeAndroidPickerStyle: false,\n                value: modeOfPaymentId || undefined\n              })\n            })]\n          }), _jsx(FormTextInput, {\n            icon: _jsx(MaterialIcons, {\n              name: \"money\",\n              size: 20,\n              color: primary\n            }),\n            onBlur: function onBlur() {\n              return setFieldTouched('amount');\n            },\n            onChangeText: function onChangeText(value) {\n              return setAmount(value);\n            },\n            label: \"Amount\",\n            placeholder: \"Amount\",\n            errorMessage: touched && errors.amount,\n            value: amount\n          }), _jsxs(View, {\n            style: my_5,\n            children: [_jsx(AppText, {\n              as: \"h5\",\n              bold: true,\n              color: darkGrey,\n              children: \"Mode of Payment\"\n            }), _jsx(View, {\n              style: bg_light,\n              children: image ? _jsx(Image, {\n                source: {\n                  uri: image\n                },\n                style: {\n                  width: 200,\n                  height: 200\n                }\n              }) : _jsx(TouchableOpacity, {\n                onPress: pickImage,\n                children: _jsx(View, {\n                  style: [row_center, p_30],\n                  children: _jsx(FontAwesome, {\n                    name: \"camera\",\n                    size: 50,\n                    color: darkGrey\n                  })\n                })\n              })\n            })]\n          }), _jsx(AppButton, {\n            onPress: handleSubmit,\n            title: \"Submit\"\n          })]\n        });\n      }\n    })]\n  });\n};\n\nexport default PaymentFormScreen;","map":{"version":3,"sources":["/Users/airagalias/Documents/GitHub/maximarket-mobile-ts/src/screens/payment/PaymentFormScreen.tsx"],"names":["React","useEffect","useState","LoadingScreen","FormTextInput","AppText","useAppDispatch","useAppSelecter","colors","styles","MaterialIcons","RNPickerSelect","ImagePicker","FontAwesome","AppButton","fetchInvoiceDetailsAsync","fetchInvoicesAsync","createPaymentAsync","resetPaymentResult","Formik","fetchModeOfPaymentsAsync","routes","PaymentFormScreen","navigation","dispatch","state","tenant","invoice","isFetchingInvoiceDetails","isSaving","modeOfPayment","modeOfPayments","isFetchingModeOfPayments","modeOfPaymentId","setModeOfPaymentId","amount","setAmount","image","setImage","imageData","setImageData","file","payment","setPayment","bg_light","container","my_5","p_5","row_center","p_30","darkGrey","primary","length","id","tenantUniqueId","pickImage","launchImageLibraryAsync","base64","mediaTypes","MediaTypeOptions","All","allowsEditing","quality","result","cancelled","uri","onSubmit","invoiceId","navigate","PAYMENT_RECEIPT","invoiceNumber","handleSubmit","setFieldTouched","errors","touched","value","map","i","label","bankName","undefined","inputAndroid","color","width","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Image, TouchableOpacity, View } from 'react-native';\nimport LoadingScreen from '../../components/indicator/LoadingScreen';\nimport FormTextInput from '../../components/input/FormTextInput';\nimport AppText from '../../components/text/AppText';\nimport { useAppDispatch, useAppSelecter } from '../../store/configureStore';\nimport colors from '../../styles/colors';\nimport { styles } from '../../styles/styles';\nimport { MaterialIcons } from '@expo/vector-icons';\nimport RNPickerSelect from 'react-native-picker-select';\nimport * as ImagePicker from 'expo-image-picker';\nimport { FontAwesome } from '@expo/vector-icons';\nimport AppButton from '../../components/button/AppButton';\nimport { fetchInvoiceDetailsAsync, fetchInvoicesAsync, createPaymentAsync, resetPaymentResult } from '../../reducers/invoiceSlice';\nimport { Formik } from 'formik';\nimport { fetchModeOfPaymentsAsync } from '../../reducers/modeOfPaymentSlice';\nimport routes from '../../navigations/routes';\n\ninterface Props {\n    navigation: any\n}\n\nconst PaymentFormScreen: React.FC<Props> = ({ navigation }) => {\n    const dispatch = useAppDispatch()\n    const { tenant } = useAppSelecter((state) => state.tenant)\n    const { invoice, isFetchingInvoiceDetails, isSaving } = useAppSelecter((state) => state.invoice)\n    const { modeOfPayments, isFetchingModeOfPayments } = useAppSelecter(state => state.modeOfPayment);\n\n    const [modeOfPaymentId, setModeOfPaymentId] = useState(\"\")\n    const [amount, setAmount] = useState(\"\")\n    const [image, setImage] = useState<any>(null);\n    const [imageData, setImageData] = useState<any>(null);\n\n    const [payment, setPayment] = useState({\n        modeOfPaymentId: \"\",\n        amount: 0,\n        file: \"\"\n    })\n\n    const { bg_light, container, my_5, p_5, row_center, p_30 } = styles\n    const { darkGrey, primary } = colors\n\n    useEffect(() => {\n        if (modeOfPayments.length > 0) {\n            setModeOfPaymentId(modeOfPayments[0].id)\n        }\n    }, [modeOfPayments])\n\n    useEffect(() => {\n        dispatch(resetPaymentResult())\n        dispatch(fetchModeOfPaymentsAsync())\n    }, [])\n\n    useEffect(() => {\n        if (!invoice) fetchInvoiceDetailsAsync(tenant?.tenantUniqueId!)\n    }, [invoice])\n\n    const pickImage = async () => {\n        let result = await ImagePicker.launchImageLibraryAsync({\n            base64: true,\n            mediaTypes: ImagePicker.MediaTypeOptions.All,\n            allowsEditing: true,\n            quality: 1,\n        });\n\n        if (!result.cancelled) {\n            setImage(result.uri);\n            setImageData(result.base64);\n        }\n    };\n\n    const onSubmit = async () => {\n        if (!!setModeOfPaymentId && !!amount && !!image) {\n            await dispatch(createPaymentAsync({\n                invoiceId: invoice?.id!,\n                modeOfPaymentId,\n                amount,\n                file: imageData!\n            }));\n            await dispatch(fetchInvoicesAsync(tenant?.tenantUniqueId!))\n            await dispatch(fetchInvoiceDetailsAsync(invoice?.id!))\n            navigation.navigate(routes.PAYMENT_RECEIPT)\n        }\n    }\n    if (isFetchingInvoiceDetails || !invoice || isFetchingModeOfPayments || isSaving) return <LoadingScreen />\n    const { invoiceNumber } = invoice\n\n    return (\n        <View style={container}>\n\n            <View style={[my_5]}>\n                <AppText as=\"h5\" bold color={darkGrey} >Invoice Number</AppText>\n                <AppText bold >{invoiceNumber}</AppText>\n            </View>\n\n            <Formik\n                initialValues={payment}\n                onSubmit={() => {\n                    onSubmit();\n                }}\n            >\n                {\n                    ({ handleSubmit, setFieldTouched, errors, touched }) => (\n                        <>\n                            <View style={my_5}>\n                                <AppText as=\"h5\" bold color={darkGrey} >Mode of Payment</AppText>\n                                <View style={[bg_light, my_5, p_5]} >\n                                    <RNPickerSelect\n                                        onValueChange={(value) => setModeOfPaymentId(value)}\n                                        items={modeOfPayments.map(i => {\n                                            return { label: i.bankName, value: i.id || undefined }\n                                        })}\n                                        placeholder={{}}\n                                        style={{ inputAndroid: { color: 'black' } }}\n                                        useNativeAndroidPickerStyle={false}\n                                        value={modeOfPaymentId || undefined}\n                                    />\n                                </View>\n                            </View>\n\n                            <FormTextInput\n                                icon={<MaterialIcons name=\"money\" size={20} color={primary} />}\n                                onBlur={() => setFieldTouched('amount')}\n                                onChangeText={(value: any) => setAmount(value)}\n                                label='Amount'\n                                placeholder='Amount'\n                                errorMessage={touched && errors.amount}\n                                value={amount}\n                            />\n\n                            <View style={my_5}>\n                                <AppText as=\"h5\" bold color={darkGrey} >Mode of Payment</AppText>\n                                <View style={bg_light}>\n                                    {\n                                        image ? <Image source={{ uri: image }} style={{ width: 200, height: 200 }} /> :\n                                            <TouchableOpacity onPress={pickImage}>\n                                                <View style={[row_center, p_30]}>\n                                                    <FontAwesome name=\"camera\" size={50} color={darkGrey} />\n                                                </View>\n                                            </TouchableOpacity>\n                                    }\n                                </View>\n                            </View>\n\n                            <AppButton onPress={handleSubmit} title='Submit' />\n\n                        </>\n                    )\n                }\n            </Formik>\n\n\n        </View>\n    );\n}\n\nexport default PaymentFormScreen;"]},"metadata":{},"sourceType":"module"}